#!/usr/bin/env bash
# This script is meant to be used with tmux
# It will create a new window with the name 'bash-btva' and run the command you select
# If the window already exists, it will just run the command in that window
# Essentially it can also be used as a maven wrapper
CMDS=("vrealize:push" "vrealize:push with dependencies" "test" "install" "package and install node dependencies")

choice=$(printf "%s\n" "${CMDS[@]}" | fzf)
if [[ $choice == "package" ]]; then
    selected="mvn clean package"
fi

if [[ $choice == "test" ]]; then
    selected="mvn clean test -DskipInstallNodeDeps=true"
fi

if [[ $choice == "install" ]]; then
    selected="mvn clean install -DskipInstallNodeDeps=true"
fi

if [[ $choice == "vrealize:push" ]]; then
    read -p "Enter Profile: (should fuzzy find in the future)" profile
    selected="mvn clean package vrealize:push -P$profile -DincludeDependencies=false -DskipInstallNodeDeps=false"
fi

if [[ $choice == "vrealize:push with dependencies" ]]; then
    read -p "Enter Profile: (should fuzzy find in the future)" profile
    selected="mvn clean package vrealize:push -P$profile -DskipInstallNodeDeps=true"
fi

# Create a new window if it doesn't exist with the name 'bash-btva' and index 100...
# ignore the error if it already exists
tmux new-window -d -t 100 -n 'bash-btva' 2> /dev/null

# Spawn it in a window, since I want to be able to quit it easily and go back to my previous window
tmux send-keys -t 'bash-btva' "$selected" Enter

# Switch to the window
tmux select-window -t 'bash-btva'

